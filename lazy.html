<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Lazy Evaluation &mdash; PyOP2 0.10.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.10.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="PyOP2 0.10.0 documentation" href="index.html" />
    <link rel="next" title="pyop2 user documentation" href="user.html" />
    <link rel="prev" title="PyOP2 Linear Algebra Interface" href="linear_algebra.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="user.html" title="pyop2 user documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="linear_algebra.html" title="PyOP2 Linear Algebra Interface"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyOP2 0.10.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="lazy-evaluation">
<h1>Lazy Evaluation<a class="headerlink" href="#lazy-evaluation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="approach">
<h2>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h2>
<p>Unless explicitly set up to execute greedily, <a class="reference internal" href="user.html#pyop2.par_loop" title="pyop2.par_loop"><tt class="xref py py-func docutils literal"><span class="pre">parallel</span> <span class="pre">loops</span></tt></a> are not executed immediatly. In doing so, it opens PyOP2 to
a range of execution rescheduling and program transformations at runtime.</p>
</div>
<div class="section" id="delaying-computations">
<h2>Delaying computations<a class="headerlink" href="#delaying-computations" title="Permalink to this headline">¶</a></h2>
<p>In order to delay the execution of parallel loops,
<a class="reference internal" href="pyop2.html#pyop2.base.ParLoop" title="pyop2.base.ParLoop"><tt class="xref py py-class docutils literal"><span class="pre">ParLoop</span></tt></a> objects inherit from
<a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a> and must implement the execution of the
parloop in the <tt class="xref py py-meth docutils literal"><span class="pre">_run()</span></tt> method.  <a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a>
objects implement <a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation.enqueue" title="pyop2.base.LazyComputation.enqueue"><tt class="xref py py-meth docutils literal"><span class="pre">enqueue()</span></tt></a>, which stores
the computation to be delayed into a list structure,
<a class="reference internal" href="pyop2.html#pyop2.base.ExecutionTrace" title="pyop2.base.ExecutionTrace"><tt class="xref py py-class docutils literal"><span class="pre">ExecutionTrace</span></tt></a>, for later execution.</p>
</div>
<div class="section" id="declaring-computations">
<h2>Declaring computations<a class="headerlink" href="#declaring-computations" title="Permalink to this headline">¶</a></h2>
<p>For the purpose of reordering the execution of parallel loops while preserving
the correctness of the PyOP2 program, when inheriting from
<a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a>, <a class="reference internal" href="pyop2.html#pyop2.base.ParLoop" title="pyop2.base.ParLoop"><tt class="xref py py-class docutils literal"><span class="pre">ParLoop</span></tt></a> objects
must declare their input/output dependencies, that is the set of
<a class="reference internal" href="user.html#pyop2.Dat" title="pyop2.Dat"><tt class="xref py py-class docutils literal"><span class="pre">Dat</span></tt></a> objects that read and/or written during the execution of
the <a class="reference internal" href="user.html#pyop2.par_loop" title="pyop2.par_loop"><tt class="xref py py-func docutils literal"><span class="pre">par_loop()</span></tt></a>. This is directly derived from the arguments of
the <a class="reference internal" href="pyop2.html#pyop2.base.ParLoop" title="pyop2.base.ParLoop"><tt class="xref py py-class docutils literal"><span class="pre">ParLoop</span></tt></a>, see the instance attributes <tt class="xref py py-attr docutils literal"><span class="pre">reads</span></tt>
and <tt class="xref py py-attr docutils literal"><span class="pre">writes</span></tt> of <a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a>.</p>
</div>
<div class="section" id="forcing-computations">
<h2>Forcing computations<a class="headerlink" href="#forcing-computations" title="Permalink to this headline">¶</a></h2>
<p>To access the up-to-date content of <a class="reference internal" href="user.html#pyop2.Dat" title="pyop2.Dat"><tt class="xref py py-class docutils literal"><span class="pre">Dats</span></tt></a>, these must
force the execution of delayed parallel loops before it can be accessed. This
is done by calling <a class="reference internal" href="pyop2.html#pyop2.base.ExecutionTrace.evaluate" title="pyop2.base.ExecutionTrace.evaluate"><tt class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></tt></a> of the
<a class="reference internal" href="pyop2.html#pyop2.base.ExecutionTrace" title="pyop2.base.ExecutionTrace"><tt class="xref py py-class docutils literal"><span class="pre">ExecutionTrace</span></tt></a> from the <a class="reference internal" href="user.html#pyop2.Dat" title="pyop2.Dat"><tt class="xref py py-class docutils literal"><span class="pre">Dat</span></tt></a>&#8216;s public
accessors, passing the reads and writes dependencies to be updated. For
instance <tt class="docutils literal"><span class="pre">evaluate(reads={a,b},</span> <span class="pre">writes={b}</span></tt>, tells <tt class="docutils literal"><span class="pre">a</span></tt> and <tt class="docutils literal"><span class="pre">b</span></tt> should be
updated with the intent of being read, and read and writen respectively.</p>
</div>
<div class="section" id="propagating-dependencies">
<h2>Propagating dependencies<a class="headerlink" href="#propagating-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The method <a class="reference internal" href="pyop2.html#pyop2.base.ExecutionTrace.evaluate" title="pyop2.base.ExecutionTrace.evaluate"><tt class="xref py py-meth docutils literal"><span class="pre">evaluate()</span></tt></a> determines which of the
delayed computations must now be executed in order to satisfy the read and
write dependencies of the given arguments. This method iterates the delayed
execution trace in reverse order: from the most to the least recently delayed
computation.</p>
<p>Let us call <img class="math" src="_images/math/754492690d0f2114252f4bdfcb5cc2643542d496.png" alt="R_a"/>, <img class="math" src="_images/math/237a058d3e73edd5a2250bd0218fa006b04120e2.png" alt="W_a"/>, <img class="math" src="_images/math/7ae5ba99f629db3530244263c12e92bbec3ed85d.png" alt="R_c"/> and <img class="math" src="_images/math/f25e10705218d7bffae5407ef5a516bc77a1163c.png" alt="W_c"/>, the read
(<img class="math" src="_images/math/eff43e84f8a3bcf7b6965f0a3248bc4d3a9d0cd4.png" alt="R"/>) and write (<img class="math" src="_images/math/10cb764f88509fb1c8012366993fdbee98f31bc5.png" alt="W"/>) dependencies passed as arguments (<img class="math" src="_images/math/c7d457e388298246adb06c587bccd419ea67f7e8.png" alt="a"/>)
and of the delayed computation (<img class="math" src="_images/math/3372c1cb6d68cf97c2d231acc0b47b95a9ed04cc.png" alt="c"/>) respectively. Computation
<img class="math" src="_images/math/3372c1cb6d68cf97c2d231acc0b47b95a9ed04cc.png" alt="c"/> is required to be executed if</p>
<div class="math">
<p><img src="_images/math/aeaca259ba44fb09bf44c796b4c99fc5d9fa4d52.png" alt="R_a \cap W_c \cup W_a \cap R_c \cup W_a \cap W_c"/></p>
</div><p>is not empty. In other words, if a dependency read is writen by <img class="math" src="_images/math/3372c1cb6d68cf97c2d231acc0b47b95a9ed04cc.png" alt="c"/>, if
a dependency written must be read first, or if a dependency is being
overwritten, preserving write ordering.</p>
<p>if <cite>c</cite> is required for <img class="math" src="_images/math/754492690d0f2114252f4bdfcb5cc2643542d496.png" alt="R_a"/> or <img class="math" src="_images/math/237a058d3e73edd5a2250bd0218fa006b04120e2.png" alt="W_a"/> then <img class="math" src="_images/math/754492690d0f2114252f4bdfcb5cc2643542d496.png" alt="R_a"/> and
<img class="math" src="_images/math/237a058d3e73edd5a2250bd0218fa006b04120e2.png" alt="W_a"/> become:</p>
<div class="math">
<p><img src="_images/math/6e1d28cd292499dcb582483a3bbd16faf8103dbb.png" alt="R_a = R_a \cup R_c \setminus W_c \\
W_a = W_a \cup W_c"/></p>
</div><p>New write dependencies need to be propagated, but read dependencies that will
be updated need not.</p>
<p>Once the iteration of the list is over, dependent computations are executed in
oldest to most recent order and removed from the list.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="lazy-split-branch">
<h3>lazy-split branch<a class="headerlink" href="#lazy-split-branch" title="Permalink to this headline">¶</a></h3>
<p>Changes:</p>
<ul class="simple">
<li>A <a class="reference internal" href="pyop2.html#pyop2.base.ParLoop" title="pyop2.base.ParLoop"><tt class="xref py py-class docutils literal"><span class="pre">ParLoop</span></tt></a> no longer inherits from
<a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a>, instead, the
<a class="reference internal" href="pyop2.html#pyop2.base.ParLoop" title="pyop2.base.ParLoop"><tt class="xref py py-class docutils literal"><span class="pre">ParLoop</span></tt></a> constructor instantiates a
<a class="reference internal" href="pyop2.html#pyop2.base.LazyComputation" title="pyop2.base.LazyComputation"><tt class="xref py py-class docutils literal"><span class="pre">LazyComputation</span></tt></a> object: start halo exchange, compute
core elements, finish halo exchange, compute owned elements, compute halo
elements. This avoids a circular dependency problem in the code.</li>
<li>Helper class (CORE, OWNED, HALO) help create finer dependencies for PyOP2
Data objects.</li>
<li>Instead of enqueuing halo exchange computation at the end of the trace, they
are push as far back as possible (as long as the previous computation is
independant of the halo echange).</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Lazy Evaluation</a><ul>
<li><a class="reference internal" href="#approach">Approach</a></li>
<li><a class="reference internal" href="#delaying-computations">Delaying computations</a></li>
<li><a class="reference internal" href="#declaring-computations">Declaring computations</a></li>
<li><a class="reference internal" href="#forcing-computations">Forcing computations</a></li>
<li><a class="reference internal" href="#propagating-dependencies">Propagating dependencies</a></li>
<li><a class="reference internal" href="#notes">Notes</a><ul>
<li><a class="reference internal" href="#lazy-split-branch">lazy-split branch</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="linear_algebra.html"
                        title="previous chapter">PyOP2 Linear Algebra Interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="user.html"
                        title="next chapter">pyop2 user documentation</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/lazy.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="user.html" title="pyop2 user documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="linear_algebra.html" title="PyOP2 Linear Algebra Interface"
             >previous</a> |</li>
        <li><a href="index.html">PyOP2 0.10.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012-2013, Imperial College et al.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>